<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Member - Flash Running Club</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="3nwp2q1ufj.png" alt="Flash Running Club Logo" style="width: 30px; height: 30px; margin-right: 10px; vertical-align: middle; animation: logo-flash 2s infinite;">
                    Admin Panel
                </div>
                <style>
                    @keyframes logo-flash {
                        0% { filter: brightness(1); }
                        50% { filter: brightness(1.4) drop-shadow(0 0 5px #facc15); }
                        100% { filter: brightness(1); }
                    }
                </style>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li><a href="admin-dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                    <li><a href="members.html"><i class="fas fa-users"></i> All Members</a></li>
                    <li><a href="add-member.html" class="active"><i class="fas fa-user-plus"></i> Add Member</a></li>
                    <li><a href="training.html"><i class="fas fa-running"></i> Trainings</a></li>
                    <li><a href="events.html"><i class="fas fa-calendar-alt"></i> Events</a></li>
                    <li><a href="payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="photos.html"><i class="fas fa-images"></i> Photos</a></li>
                    <li><a href="about-us.html"><i class="fas fa-info-circle"></i> About Us</a></li>
                    <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Mobile Header -->
            <div class="mobile-header">
                <div class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
                <div>
                    <img src="3nwp2q1ufj.png" alt="Flash Running Club Logo" style="width: 24px; height: 24px; margin-right: 5px; vertical-align: middle; animation: logo-flash 2s infinite;">
                    <span style="font-size: 0.8rem; white-space: nowrap; font-weight: bold;">Flash Running Club</span>
                </div>
            </div>

            <div class="content-header">
                <h2>Add New Member</h2>
                <p>Create a new member account</p>
            </div>

            <!-- Normal Add Member Form -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Member Information</h3>
                </div>
                <div class="card-body">
                    <form id="addMemberForm">
                        <div class="form-group">
                            <label for="fullName">Full Name</label>
                            <input type="text" id="fullName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" class="form-control" required>
                            <small>Used for login</small>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" id="email" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="emergencyContact">Emergency Contact Number</label>
                            <input type="tel" id="emergencyContact" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="joinDate">Join Date</label>
                            <input type="date" id="joinDate" class="form-control" required>
                        </div>
                        
                        <div id="addMemberResult" class="text-center" style="margin: 10px 0;"></div>
                        
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Add Member</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase App SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/members.js"></script>
    <script src="js/sidebar.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default join date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('joinDate').value = today;
            
            // Check if user is logged in as admin
            if (localStorage.getItem('userType') !== 'admin' || !localStorage.getItem('username')) {
                window.location.href = 'admin-login.html';
                return;
            }

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });

            // Handle add member form submission
            document.getElementById('addMemberForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const resultElement = document.getElementById('addMemberResult');
                
                if (!username || !password || !document.getElementById('fullName').value || 
                    !document.getElementById('phone').value || !document.getElementById('email').value || 
                    !document.getElementById('emergencyContact').value || !document.getElementById('joinDate').value) {
                    resultElement.innerHTML = '<div style="color: red;">Please fill in all required fields.</div>';
                    return;
                }
                
                resultElement.innerHTML = '<div>Adding member...</div>';
                
                // First try to add member to local storage
                const memberData = {
                    username: username,
                    password: password,
                    fullName: document.getElementById('fullName').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    emergencyContact: document.getElementById('emergencyContact').value.trim(),
                    joinDate: document.getElementById('joinDate').value
                };
                
                // Add to local storage first
                if (addMember(memberData)) {
                    // Then try to add to Firebase if available
                    try {
                        // Check if username already exists in Firebase
                        firebase.database().ref('members/' + username).once('value')
                            .then((snapshot) => {
                                if (snapshot.exists()) {
                                    console.log('Member already exists in Firebase, but was added to local storage');
                                } else {
                                    // Remove username from data to match Firebase structure
                                    const firebaseData = { ...memberData };
                                    delete firebaseData.username;
                                    
                                    // Add to Firebase
                                    firebase.database().ref('members/' + username).set(firebaseData);
                                }
                            })
                            .catch(err => {
                                console.error('Firebase error:', err);
                            });
                    } catch (e) {
                        console.log('Firebase not available or error:', e);
                    }
                    
                    resultElement.innerHTML = '<div style="color: green;">Member added successfully!</div>';
                    document.getElementById('addMemberForm').reset();
                    document.getElementById('joinDate').value = today;
                } else {
                    resultElement.innerHTML = '<div style="color: red;">Username already exists. Please choose another.</div>';
                    return;
                }
                // End of form submission handler
            });
        });
    </script>
</body>
</html>